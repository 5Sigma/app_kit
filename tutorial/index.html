<!doctype html>
<html>
<head>
<link href="../stylesheets/normalize.css" rel="stylesheet" type="text/css" /><link href="../stylesheets/main.css" rel="stylesheet" type="text/css" />
<script src="../javascripts/all.js" type="text/javascript"></script>
</head>
<body>
<header>
<div class='title'>
app
<strong>
kit
</strong>
</div>
<small>Advanced data applications in minutes</small>
<nav>
<a class="" href="/">home</a>
<a class="" href="/overview/">overview</a>
<a class="" href="/reference/">reference</a>
<a class="active" href="/tutorial/">tutorial</a>
<a href='https://github.com/5Sigma/app_kit/'>code</a>
</nav>
</header>

<div class='page-container'>
<div class='side-nav'>
<ul>
<li>
<a href='/'>Generating a new project</a>
</li>
<li>
<a href='#models'>Data models</a>
</li>
<li>
<a href='#resources'>Resources</a>
<ul>
<li>
<a href='#customer-resource'>Customer resource</a>
</li>
<li>
<a href='#invoice-resource'>Invoice resource</a>
</li>
<li>
<a href='#invoice-item-resource'>Invoice item resource</a>
</li>
</ul>
</li>
<li>
<a href='#user'>Creating a user</a>
</li>
<li>
<a href='#improvements'>Cleanin up</a>
<ul>
<li>
<a href='#model-display-text'>Model display text</a>
</li>
</ul>
</li>
</ul>
</div>
<div class='article-container'>
<h3>Generating a new project</h3>

<p>To get started we will setup a new rails project.</p>
<pre class="highlight plaintext"><code>rails new crm
</code></pre>

<p>This will create a new folder called <code>crm</code> with your project files in it. The
first thing we need to do is add AppKit to it. Open the file <code>Gemfile</code> and add
the following line somewhere in the file.</p>
<pre class="highlight ruby"><code><span class="n">gem</span> <span class="s1">'app_kit'</span>
</code></pre>

<p>Then run the bundle command:</p>
<pre class="highlight plaintext"><code>bundle
</code></pre>

<p>This will install the AppKit gem and all of its dependencies as well as set them
up in your project.</p>

<p>To setup the project run the AppKit install generator. This will create a
migration for the users table and install an initializer.</p>
<pre class="highlight plaintext"><code>rails g app_kit:install
</code></pre>

<p><a id="models" name="models"></a></p>

<h3>Setting up data models</h3>

<p>We will use the default database settings for Rails, which is Sqlite3 and
ActiveRecord. To create a few models we can use Rails&rsquo; built in generators.</p>
<pre class="highlight plaintext"><code>rails g model customer
rails g model invoice
rails g model invoice_item
</code></pre>

<p>Edit the customer migration created in <code>db/migrate/XXXXXXXX_create_customer.rb</code>.</p>
<pre class="highlight ruby"><code><span class="k">class</span> <span class="nc">CreateCustomers</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Migration</span>
  <span class="k">def</span> <span class="nf">change</span>
    <span class="n">create_table</span> <span class="ss">:customers</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
      <span class="n">t</span><span class="p">.</span><span class="nf">string</span> <span class="ss">:first_name</span>
      <span class="n">t</span><span class="p">.</span><span class="nf">string</span> <span class="ss">:last_name</span>
      <span class="n">t</span><span class="p">.</span><span class="nf">string</span> <span class="ss">:phone_number</span>
      <span class="n">t</span><span class="p">.</span><span class="nf">string</span> <span class="ss">:email</span>
      <span class="n">t</span><span class="p">.</span><span class="nf">boolean</span> <span class="ss">:active</span>
      <span class="n">t</span><span class="p">.</span><span class="nf">timestamps</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>

<p>Edit the invoice migration created at <code>db/migrate/XXXXXXX_create_invoices</code>.</p>
<pre class="highlight ruby"><code><span class="k">class</span> <span class="nc">CreateInvoices</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Migration</span>
  <span class="k">def</span> <span class="nf">change</span>
    <span class="n">create_table</span> <span class="ss">:invoices</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
      <span class="n">t</span><span class="p">.</span><span class="nf">belongs_to</span> <span class="ss">:customer</span>
      <span class="n">t</span><span class="p">.</span><span class="nf">integer</span> <span class="ss">:invoice_number</span>
      <span class="n">t</span><span class="p">.</span><span class="nf">decimal</span> <span class="ss">:invoice_total</span>
      <span class="n">t</span><span class="p">.</span><span class="nf">datetime</span> <span class="ss">:invoice_date</span>
      <span class="n">t</span><span class="p">.</span><span class="nf">boolean</span> <span class="ss">:paid</span>
      <span class="n">t</span><span class="p">.</span><span class="nf">boolean</span> <span class="ss">:published</span>
      <span class="n">t</span><span class="p">.</span><span class="nf">timestamps</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>

<p>Edit the invoice_item migration created at
<code>db/migrate/XXXXXX_create_invoice_items</code>.</p>
<pre class="highlight ruby"><code><span class="k">class</span> <span class="nc">CreateInvoiceItems</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Migration</span>
  <span class="k">def</span> <span class="nf">change</span>
    <span class="n">create_table</span> <span class="ss">:invoice_items</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
      <span class="n">t</span><span class="p">.</span><span class="nf">belongs_to</span> <span class="ss">:invoice</span>
      <span class="n">t</span><span class="p">.</span><span class="nf">string</span> <span class="ss">:description</span>
      <span class="n">t</span><span class="p">.</span><span class="nf">decimal</span> <span class="ss">:unit_price</span>
      <span class="n">t</span><span class="p">.</span><span class="nf">decimal</span> <span class="ss">:quantity</span>
      <span class="n">t</span><span class="p">.</span><span class="nf">decimal</span> <span class="ss">:extended_price</span>
      <span class="n">t</span><span class="p">.</span><span class="nf">timestamps</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>

<p>Migrate your database to create the tables.</p>
<pre class="highlight plaintext"><code>rake db:migrate
</code></pre>

<p>Next add your associations to your model files located in <code>app/model/</code>.</p>
<pre class="highlight ruby"><code><span class="c1">#customer.rb</span>
<span class="k">class</span> <span class="nc">Customer</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">has_many</span> <span class="ss">:invoices</span>
<span class="k">end</span>

<span class="c1">#invoice.rb</span>
<span class="k">class</span> <span class="nc">Invoice</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">belongs_to</span> <span class="ss">:customer</span>
<span class="k">end</span>

<span class="c1">#invoice_item.rb</span>
<span class="k">class</span> <span class="nc">InvoiceItem</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">belongs_to</span> <span class="ss">:invoice</span>
<span class="k">end</span>
</code></pre>

<p><a id="resources" name="resources"></a></p>

<h3>Defining AppKit resources</h3>

<p>From the root of your project run the <code>app_kit:resource</code> generator for each
model.</p>
<pre class="highlight plaintext"><code>app_kit:resource customer
app_kit:resource invoice
app_kit:resource invoice_item
</code></pre>

<p>The generated resource files will have many commented lines that can be used as
a quick syntax reference. For the sake of brevity those will be ignored below.</p>

<p>The resource files will be generated with default options for all the database
fields in the tables. We will tweak them just a bit to improve the setup.</p>

<p><a id="customer-resource" name="customer-resource"></a></p>

<h4>Customer resource</h4>

<p>Open the customer resource file located at <code>app/app_kit/customer.rb</code>.</p>
<pre class="highlight ruby"><code><span class="no">AppKit</span><span class="p">.</span><span class="nf">register</span> <span class="no">Customer</span> <span class="k">do</span>
    <span class="n">show_in_navigation</span> <span class="kp">true</span>
    <span class="n">icon</span> <span class="s1">'user'</span>

    <span class="n">field</span> <span class="ss">:first_name</span><span class="p">,</span> <span class="ss">show_in_table: </span><span class="kp">false</span><span class="p">,</span> <span class="ss">show_in_details: </span><span class="kp">false</span>
    <span class="n">field</span> <span class="ss">:last_name</span><span class="p">,</span> <span class="ss">show_in_table: </span><span class="kp">false</span><span class="p">,</span> <span class="ss">show_in_details: </span><span class="kp">false</span>
    <span class="n">field</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">formatter: :email</span>
    <span class="n">field</span> <span class="ss">:phone_number</span><span class="p">,</span> <span class="ss">:formatter</span> <span class="o">=&gt;</span> <span class="ss">:phone</span>
    <span class="n">field</span> <span class="ss">:active</span>
    <span class="n">field</span> <span class="ss">:created_at</span><span class="p">,</span> <span class="ss">show_in_table: </span><span class="kp">false</span><span class="p">,</span> <span class="ss">editable: </span><span class="kp">false</span>
    <span class="n">field</span> <span class="ss">:updated_at</span><span class="p">,</span> <span class="ss">show_in_table: </span><span class="kp">false</span><span class="p">,</span> <span class="ss">editable: </span><span class="kp">false</span>

<span class="k">end</span>
</code></pre>

<p><a id="invoice-resource" name="invoice-resource"></a></p>

<h4>Invoice resource</h4>

<p>Open the invoice resource file located at <code>app/app_kit/invoice.rb</code>.</p>
<pre class="highlight ruby"><code><span class="no">AppKit</span><span class="p">.</span><span class="nf">register</span> <span class="no">Invoice</span> <span class="k">do</span>
    <span class="n">show_in_navigation</span> <span class="kp">true</span>

    <span class="n">icon</span> <span class="s1">'list'</span>
    <span class="n">field</span> <span class="ss">:invoice_number</span><span class="p">,</span> <span class="ss">editable: </span><span class="kp">false</span>
    <span class="n">field</span> <span class="ss">:customer_id</span>
    <span class="n">field</span> <span class="ss">:invoice_total</span><span class="p">,</span> <span class="ss">editable: </span><span class="kp">false</span><span class="p">,</span> <span class="ss">:formatter</span> <span class="o">=&gt;</span> <span class="ss">:currency</span>
    <span class="n">field</span> <span class="ss">:invoice_date</span><span class="p">,</span> <span class="ss">:formatter</span> <span class="o">=&gt;</span> <span class="ss">:date</span>
<span class="k">end</span>
</code></pre>

<p><a id="invoice-item-resource" name="invoice-item-resource"></a></p>

<h4>Invoice item resource</h4>

<p>Open the invoice_item resource file located at <code>app/app_kit/invoice.rb</code>.</p>
<pre class="highlight ruby"><code><span class="no">AppKit</span><span class="p">.</span><span class="nf">register</span> <span class="no">InvoiceItem</span> <span class="k">do</span>
    <span class="n">field</span> <span class="ss">:description</span>
    <span class="n">field</span> <span class="ss">:invoice_id</span>
    <span class="n">field</span> <span class="ss">:unit_price</span><span class="p">,</span> <span class="ss">:formatter</span> <span class="o">=&gt;</span> <span class="ss">:currency</span>
    <span class="n">field</span> <span class="ss">:extended_price</span><span class="p">,</span> <span class="ss">editable: </span><span class="kp">false</span><span class="p">,</span> <span class="ss">:formatter</span> <span class="o">=&gt;</span> <span class="ss">:currency</span>
    <span class="n">field</span> <span class="ss">:quantity</span>
<span class="k">end</span>
</code></pre>

<p><a id="user" name="user"></a></p>

<h3>Create a user account</h3>

<p>AppKit automatically handles user authorization so you will need an initial
user in order to access the application. The quickest way to create a user
is through the rails console by running the command</p>
<pre class="highlight plaintext"><code>rails console
</code></pre>

<p>Once in the rails console run the following code (You can change the name and
password if you would like):</p>
<pre class="highlight ruby"><code><span class="no">AppKit</span><span class="o">::</span><span class="no">User</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span>
  <span class="ss">first_name: </span><span class="s1">'John'</span><span class="p">,</span>
  <span class="ss">last_name: </span><span class="s1">'Doe'</span><span class="p">,</span>
  <span class="ss">password: </span><span class="s1">'some passphrase'</span><span class="p">,</span>
  <span class="ss">password_confirmation: </span><span class="s1">'some passphrase'</span>
<span class="p">)</span>
</code></pre>

<h3>Up and running</h3>

<p>Thats it run the rails server and open a browser to <code>http://localhost:3000</code>.</p>
<pre class="highlight plaintext"><code>rails server
</code></pre>

<p><a id="improvements" name="improvements"></a></p>

<h3>Tightening things up</h3>

<p>There are a few changes we can make to improve the way everything works and
looks.</p>

<p><a id="model-display-text" name="model-display-text"></a></p>

<h4>Model display text</h4>

<p>When a model&rsquo;s instance needs to be displayed its <code>#to_s</code> method is used to
output it as a string. You should override the method on each model to give it 
nicer display text.</p>

<p>Add the following functions to the three model classes inside <code>app/models</code>.</p>
<pre class="highlight ruby"><code><span class="c1"># customer.rb</span>
<span class="k">def</span> <span class="nf">to_s</span>
  <span class="s2">"</span><span class="si">#{</span><span class="n">first_name</span><span class="si">}</span><span class="s2"> </span><span class="si">#{</span><span class="n">last_name</span><span class="si">}</span><span class="s2">"</span>
<span class="k">end</span>

<span class="c1"># invoice.rb</span>
<span class="k">def</span> <span class="nf">to_s</span>
  <span class="n">invoice_number</span>
<span class="k">end</span>

<span class="c1">#invoice_items.rb</span>
<span class="k">def</span> <span class="nf">to_s</span>
  <span class="n">description</span>
<span class="k">end</span>
</code></pre>

</div>
</div>

<footer>
<div class='div'>
AppKit is an open source project, you can download the sourcecode
<a href='https://github.com/5Sigma/app_kit/'>here.</a>
</div>
<div class='div'>
This project is maintained by
<a href='http://5sigma.io'>5Sigma.</a>
</div>
</footer>

</body>
</html>
